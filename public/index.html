<!DOCTYPE html>
<html>

<head>
    <title>Live Stock Prices</title>
    <style>
        body {
            font-family: Arial;
            background: #0f172a;
            color: #e5e7eb
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        th,
        td {
            padding: 8px;
            border-bottom: 1px solid #334155
        }

        th {
            background: #020617;
            position: sticky;
            top: 0
        }
    </style>
</head>

<body>

    <h2>ðŸ“ˆ Real-Time Stock Prices</h2>

    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Price</th>
                <th>Updated</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <script>
        const ws = new WebSocket("ws://localhost:3000");
        const prices = {};

        ws.onmessage = e => {
            const d = JSON.parse(e.data);
            if (!d.symbol) return;

            prices[d.symbol] = d;
            render();
        };

        function render() {
            const tbody = document.getElementById("rows");
            tbody.innerHTML = "";

            Object.values(prices).forEach(p => {
                tbody.innerHTML += `
      <tr>
        <td>${p.symbol}</td>
        <td>${p.price}</td>
        <td>${p.time}</td>
      </tr>
    `;
            });
        }
    </script>

    <script>
        const ws = new WebSocket("ws://localhost:3000");
        const tbody = document.getElementById("rows");

        ws.onopen = () => {
            addRow("SYSTEM", "WebSocket connected", "");
        };

        ws.onmessage = e => {
            const d = JSON.parse(e.data);

            if (d.raw) {
                addRow(
                    "RAW",
                    JSON.stringify(d.data),
                    d.time
                );
                return;
            }

            addRow(d.symbol, d.price, d.time);
        };

        function addRow(symbol, price, time) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
    <td>${symbol}</td>
    <td>${price}</td>
    <td>${time}</td>
  `;
            tbody.prepend(tr);
        }
    </script>


</body>

</html>